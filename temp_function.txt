// Function to create appropriate fix button based on anomaly type
function createFixButtonHtml(issue) {
  const reason = issue.reason.toLowerCase();
  const questionType = issue.question_type;
  
  // MCQ with no correct answers
  if (reason.includes('mcq with no correct answers')) {
    return `<br><div style="background: #ffebee; border-left: 4px solid #f44336; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
              <div style="font-weight: bold; color: #c62828; margin-bottom: 5px;">🚨 Critical Issue: No Correct Answers</div>
              <div style="margin-bottom: 8px;">This MCQ has no options marked as correct, making it impossible to grade.</div>
              <div style="text-align: right;">
                <button onclick="showQuestionDetails(${issue.id})" style="
                  background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                  padding: 4px; border-radius: 3px;
                " title="View Details">🔍</button>
              </div>
            </div>`;
  }
  
  // MCQ with all correct answers
  if (reason.includes('mcq with all answers marked correct')) {
    return `<br><div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
              <div style="font-weight: bold; color: #ef6c00; margin-bottom: 5px;">⚠️ Logic Error: All Answers Correct</div>
              <div style="margin-bottom: 8px;">Every option is marked correct. At least one should be incorrect for a valid MCQ.</div>
              <div style="text-align: right;">
                <button onclick="showQuestionDetails(${issue.id})" style="
                  background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                  padding: 4px; border-radius: 3px;
                " title="View Details">🔍</button>
              </div>
            </div>`;
  }
  
  // TrueFalse with multiple correct answers
  if (reason.includes('truefalse with multiple correct answers')) {
    return `<br><div style="background: #fce4ec; border-left: 4px solid #e91e63; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
              <div style="font-weight: bold; color: #c2185b; margin-bottom: 5px;">🚫 Invalid T/F: Multiple Correct</div>
              <div style="margin-bottom: 8px;">True/False questions can only have ONE correct answer. Fix the logic or change question type.</div>
              <div style="text-align: right;">
                <button onclick="showQuestionDetails(${issue.id})" style="
                  background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                  padding: 4px; border-radius: 3px;
                " title="View Details">🔍</button>
              </div>
            </div>`;
  }
  
  // Insufficient options
  if (reason.includes('insufficient options')) {
    const optionCount = reason.match(/only (\d+) option/)?.[1] || '0';
    return `<br><div style="background: #e8f5e8; border-left: 4px solid #4caf50; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
              <div style="font-weight: bold; color: #2e7d32; margin-bottom: 5px;">➕ Need More Options</div>
              <div style="margin-bottom: 8px;">Only ${optionCount} option${optionCount === '1' ? '' : 's'} found. ${questionType} questions need at least 2 options.</div>
              <div style="text-align: right;">
                <button onclick="showQuestionDetails(${issue.id})" style="
                  background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                  padding: 4px; border-radius: 3px;
                " title="View Details">🔍</button>
              </div>
            </div>`;
  }
  
  // Insufficient match_pairs
  if (reason.includes('insufficient match_pairs')) {
    const pairCount = reason.match(/only (\d+) pair/)?.[1] || '0';
    return `<br><div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
              <div style="font-weight: bold; color: #1976d2; margin-bottom: 5px;">🔗 Need More Match Pairs</div>
              <div style="margin-bottom: 8px;">Only ${pairCount} match pair${pairCount === '1' ? '' : 's'} found. Match questions need at least 2 pairs.</div>
              <div style="text-align: right;">
                <button onclick="showQuestionDetails(${issue.id})" style="
                  background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                  padding: 4px; border-radius: 3px;
                " title="View Details">🔍</button>
              </div>
            </div>`;
  }
  
  // Orphan questions
  if (reason.includes('orphan question')) {
    const missingData = questionType === 'Match' ? 'match_pairs' : 'options';
    return `<br><div style="background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
              <div style="font-weight: bold; color: #7b1fa2; margin-bottom: 5px;">👤 Orphan Question</div>
              <div style="margin-bottom: 8px;">This ${questionType} question has no ${missingData} associated with it.</div>
              <div style="text-align: right;">
                <button onclick="showQuestionDetails(${issue.id})" style="
                  background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                  padding: 4px; border-radius: 3px;
                " title="View Details">🔍</button>
              </div>
            </div>`;
  }
  
  // Generic manual fix for other issues
  return `<br><div style="background: #f5f5f5; border-left: 4px solid #607d8b; padding: 10px; margin-top: 8px; font-size: 0.85em; border-radius: 4px;">
            <div style="font-weight: bold; color: #455a64; margin-bottom: 5px;">🛠️ Manual Review Required</div>
            <div style="margin-bottom: 8px;">This issue requires manual analysis and correction.</div>
            <div style="text-align: right;">
              <button onclick="showQuestionDetails(${issue.id})" style="
                background: none; border: none; color: #2196f3; cursor: pointer; font-size: 1.2em; 
                padding: 4px; border-radius: 3px;
              " title="View Details">🔍</button>
            </div>
          </div>`;
}