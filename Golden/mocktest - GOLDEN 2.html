Perfect üëç I‚Äôve integrated everything we discussed:

* **Filter panel is inline** ‚Äî shows immediately under the ‚ÄúChoose Test‚Äù button.
* **Topics filter** with ‚ÄúALL‚Äù controlling children and syncing.
* **Types filter** with the same ‚ÄúALL‚Äù logic.
* **Explanation mode** choice (default = only when wrong).
* **Start Test** button renders the test right below the filters.
* Explanations & references appear per your setting.

---

## üåê Full Code (`mocktest.html`)

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background: #0078d7;
      color: white;
      width: 100%;
      padding: 20px;
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
    }
    main {
      max-width: 900px;
      width: 95%;
      margin: 20px auto;
    }
    .controls {
      margin: 20px 0;
      text-align: center;
    }
    #fileInput { display: none; }
    .custom-btn {
      background: #0078d7;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
    }
    .custom-btn:hover { background: #005ea3; }
    .question-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border: 2px solid transparent;
    }
    .question-card h3 { margin-top: 0; }
    .correct { color: green; font-weight: bold; }
    .wrong { color: red; font-weight: bold; }
    .explanation { margin-top: 8px; font-style: italic; }
    .reference { margin-top: 4px; font-size: 0.9em; color: #333; }
    .disabled { pointer-events: none; opacity: 0.6; }
    .active { border: 2px solid #0078d7; box-shadow: 0 0 8px rgba(0,120,215,0.6); }
    .locked { pointer-events: none; opacity: 1 !important; }
    button {
      background: #0078d7;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95em;
      margin-top: 8px;
    }
    button:hover { background: #005ea3; }
    #restart { margin-top: 20px; display: none; }
    #scoreboard {
      margin: 20px 0;
      font-size: 1.2em;
      text-align: center;
    }
    #message {
      font-size: 1.1em;
      margin-top: 10px;
      font-weight: bold;
    }
    #message.excellent { color: green; }
    #message.good { color: #0078d7; }
    #message.fair { color: orange; }
    #message.poor { color: red; }
    .filter-panel {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0 20px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .filter-panel h3 {
      margin-top: 0;
      color: #0078d7;
    }
    .filter-section { margin-bottom: 15px; }
    label { cursor: pointer; }
    .match-table {
      display: table;
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    .match-row { display: table-row; }
    .match-cell {
      display: table-cell;
      padding: 6px 8px;
      vertical-align: middle;
    }
    .match-cell:first-child {
      font-weight: bold;
      width: 40%;
    }
    select {
      width: 100%;
      padding: 4px;
    }
  </style>
</head>
<body>
  <header id="test-title">Mock Test Application</header>
  <main>
    <div class="controls">
      <label for="fileInput" class="custom-btn">üìÇ Choose Test</label>
      <input type="file" id="fileInput" accept=".json">
    </div>
    <div id="filter-panel"></div>
    <div id="test"></div>
    <div id="scoreboard"></div>
    <div style="text-align:center;">
      <button id="restart">üîÑ Restart Test</button>
    </div>
  </main>

  <script>
    let questions = [];
    let originalData = null;
    let score = 0;
    let explanationMode = 1; // 1 = only wrong, 2 = always, 3 = never

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const data = JSON.parse(event.target.result);
          originalData = data;
          buildFilterPanel(data.questions);
        } catch (err) {
          alert("Invalid JSON file.");
        }
      };
      reader.readAsText(file);
    });

    function setupAllCheckbox(sectionDiv) {
      const checkboxes = sectionDiv.querySelectorAll("input[type=checkbox]");
      const allBox = checkboxes[0];
      const children = Array.from(checkboxes).slice(1);

      allBox.addEventListener("change", () => {
        children.forEach(cb => cb.checked = allBox.checked);
      });

      children.forEach(cb => {
        cb.addEventListener("change", () => {
          if (children.every(c => c.checked)) {
            allBox.checked = true;
          } else {
            allBox.checked = false;
          }
        });
      });
    }

    function buildFilterPanel(allQuestions) {
      const panel = document.getElementById("filter-panel");
      panel.innerHTML = "";

      const topics = [...new Set(allQuestions.map(q => q.topic))];
      const types = [...new Set(allQuestions.map(q => q.type))];

      const wrapper = document.createElement("div");
      wrapper.className = "filter-panel";

      // Topics
      const topicDiv = document.createElement("div");
      topicDiv.className = "filter-section";
      topicDiv.innerHTML = "<h3>Select Topics</h3>";
      const allTopics = document.createElement("label");
      allTopics.innerHTML = `<input type="checkbox" value="ALL" checked> ALL`;
      topicDiv.appendChild(allTopics);
      topics.forEach(t => {
        const l = document.createElement("label");
        l.style.display = "block";
        l.innerHTML = `<input type="checkbox" value="${t}" checked> ${t}`;
        topicDiv.appendChild(l);
      });
      setupAllCheckbox(topicDiv);

      // Types
      const typeDiv = document.createElement("div");
      typeDiv.className = "filter-section";
      typeDiv.innerHTML = "<h3>Select Question Types</h3>";
      const allTypes = document.createElement("label");
      allTypes.innerHTML = `<input type="checkbox" value="ALL" checked> ALL`;
      typeDiv.appendChild(allTypes);
      types.forEach(t => {
        const l = document.createElement("label");
        l.style.display = "block";
        l.innerHTML = `<input type="checkbox" value="${t}" checked> ${t}`;
        typeDiv.appendChild(l);
      });
      setupAllCheckbox(typeDiv);

      // Explanation display mode
      const expDiv = document.createElement("div");
      expDiv.className = "filter-section";
      expDiv.innerHTML = "<h3>Explanation & Reference Display</h3>";
      expDiv.innerHTML += `
        <label><input type="radio" name="expMode" value="1" checked> Only when wrong</label><br>
        <label><input type="radio" name="expMode" value="2"> Both when right and wrong</label><br>
        <label><input type="radio" name="expMode" value="3"> Do not display explanations</label>
      `;

      const startBtn = document.createElement("button");
      startBtn.textContent = "Start Test";
      startBtn.addEventListener("click", () => {
        let selectedTopics = [];
        let selectedTypes = [];

        const topicChecks = topicDiv.querySelectorAll("input[type=checkbox]");
        if (topicChecks[0].checked) {
          selectedTopics = topics;
        } else {
          topicChecks.forEach((cb, i) => {
            if (i > 0 && cb.checked) selectedTopics.push(cb.value);
          });
        }

        const typeChecks = typeDiv.querySelectorAll("input[type=checkbox]");
        if (typeChecks[0].checked) {
          selectedTypes = types;
        } else {
          typeChecks.forEach((cb, i) => {
            if (i > 0 && cb.checked) selectedTypes.push(cb.value);
          });
        }

        const expChoice = expDiv.querySelector("input[name=expMode]:checked");
        explanationMode = parseInt(expChoice.value);

        const filtered = allQuestions.filter(q => 
          selectedTopics.includes(q.topic) && selectedTypes.includes(q.type)
        );
        if (filtered.length === 0) {
          alert("No questions match your filters.");
          return;
        }
        startTest(filtered);
      });

      wrapper.appendChild(topicDiv);
      wrapper.appendChild(typeDiv);
      wrapper.appendChild(expDiv);
      wrapper.appendChild(startBtn);

      panel.appendChild(wrapper);
    }

    function startTest(filteredQuestions) {
      const container = document.getElementById("test");
      container.innerHTML = "";
      document.getElementById("restart").style.display = "none";
      document.getElementById("scoreboard").innerHTML = "";
      score = 0;

      document.getElementById("test-title").textContent = originalData.title || "Mock Test";

      questions = shuffle(filteredQuestions.map(q => {
        if (q.options) q.options = shuffle([...q.options]);
        return q;
      }));

      renderTest(questions);

      questions.slice(1).forEach(q => {
        document.getElementById(`q-${q.id}`).classList.add("disabled");
      });

      document.getElementById(`q-${questions[0].id}`).classList.add("active");
    }

    function renderTest(questions) {
      const container = document.getElementById("test");

      questions.forEach((q, qIndex) => {
        const qDiv = document.createElement("div");
        qDiv.className = "question-card";
        qDiv.id = `q-${q.id}`;

        const qTitle = document.createElement("h3");
        qTitle.textContent = `${qIndex + 1}. ${q.question}`;
        qDiv.appendChild(qTitle);

        if (q.type === "single" || q.type === "assertion") {
          q.options.forEach(opt => {
            const label = document.createElement("label");
            label.style.display = "block";
            const input = document.createElement("input");
            input.type = "radio";
            input.name = `q${q.id}`;
            input.value = opt;
            input.addEventListener("change", () => {
              handleAnswer(q, [opt], qDiv, qIndex);
            });
            label.appendChild(input);
            label.append(" " + opt);
            qDiv.appendChild(label);
          });
        }
        else if (q.type === "multiple") {
          q.options.forEach(opt => {
            const label = document.createElement("label");
            label.style.display = "block";
            const input = document.createElement("input");
            input.type = "checkbox";
            input.name = `q${q.id}`;
            input.value = opt;
            label.appendChild(input);
            label.append(" " + opt);
            qDiv.appendChild(label);
          });

          const submitBtn = document.createElement("button");
          submitBtn.textContent = "Submit Answer";
          submitBtn.addEventListener("click", () => {
            const selected = Array.from(qDiv.querySelectorAll("input[type=checkbox]:checked"))
              .map(cb => cb.value);
            handleAnswer(q, selected, qDiv, qIndex);
          });
          qDiv.appendChild(submitBtn);
        }
        else if (q.type === "match") {
          const keys = Object.keys(q.matchPairs);
          const values = shuffle(Object.values(q.matchPairs));

          const table = document.createElement("div");
          table.className = "match-table";

          const selects = [];

          keys.forEach(k => {
            const row = document.createElement("div");
            row.className = "match-row";

            const left = document.createElement("div");
            left.className = "match-cell";
            left.textContent = k;

            const right = document.createElement("div");
            right.className = "match-cell";
            const select = document.createElement("select");

            const placeholder = document.createElement("option");
            placeholder.value = "";
            placeholder.textContent = "<Select One>";
            placeholder.disabled = true;
            placeholder.selected = true;
            select.appendChild(placeholder);

            values.forEach(v => {
              const opt = document.createElement("option");
              opt.value = v;
              opt.textContent = v;
              select.appendChild(opt);
            });

            selects.push(select);
            right.appendChild(select);
            row.appendChild(left);
            row.appendChild(right);
            table.appendChild(row);
          });

          qDiv.appendChild(table);

          const submitBtn = document.createElement("button");
          submitBtn.textContent = "Submit Matches";
          submitBtn.disabled = true;

          selects.forEach(sel => {
            sel.addEventListener("change", () => {
              const allFilled = selects.every(s => s.value !== "");
              submitBtn.disabled = !allFilled;
            });
          });

          submitBtn.addEventListener("click", () => {
            const selections = {};
            keys.forEach((k, i) => {
              selections[k] = selects[i].value;
            });
            handleAnswer(q, selections, qDiv, qIndex);
          });

          qDiv.appendChild(submitBtn);
        }

        container.appendChild(qDiv);
      });
    }

    function handleAnswer(question, chosen, qDiv, qIndex) {
      if (qDiv.classList.contains("locked")) return;

      qDiv.classList.remove("active");
      qDiv.classList.add("locked");

      let isCorrect = false;

      if (question.type === "single" || question.type === "assertion") {
        isCorrect = (chosen[0] === question.answer);
      }
      else if (question.type === "multiple") {
        const correct = new Set(question.answer);
        const selected = new Set(chosen);
        isCorrect = (correct.size === selected.size && [...correct].every(x => selected.has(x)));
      }
      else if (question.type === "match") {
        isCorrect = JSON.stringify(chosen) === JSON.stringify(question.matchPairs);
      }

      if (isCorrect) {
        qDiv.insertAdjacentHTML("beforeend", `<p class="correct">‚úÖ Correct!</p>`);
        score++;
      } else {
        qDiv.insertAdjacentHTML("beforeend", `<p class="wrong">‚ùå Wrong. Correct answer: ${
          question.type === "multiple" ? question.answer.join(", ") :
          question.type === "match" ? Object.entries(question.matchPairs).map(([k,v]) => `${k} ‚Üí ${v}`).join("; ") :
          question.answer
        }</p>`);
      }

      // Explanation/Reference display logic
      if (explanationMode === 2 || (explanationMode === 1 && !isCorrect)) {
        if (question.explanation) {
          qDiv.insertAdjacentHTML("beforeend", `<p class="explanation">üí° Explanation: ${question.explanation}</p>`);
        }
        if (question.reference) {
          qDiv.insertAdjacentHTML("beforeend", `<p class="reference">üìñ Reference: ${question.reference}</p>`);
        }
      }

      const nextQ = document.getElementById(`q-${questions[qIndex + 1]?.id}`);
      if (nextQ) {
        nextQ.classList.remove("disabled");
        nextQ.classList.add("active");
      } else {
        showFinalScore();
      }
    }

    function showFinalScore() {
      const total = questions.length;
      const percent = Math.round((score / total) * 100);

      let message = "";
      let cssClass = "";

      if (percent >= 90) {
        message = "üåü Outstanding performance! You‚Äôve clearly mastered the material.";
        cssClass = "excellent";
      } else if (percent >= 70) {
        message = "üëç Well done! You have a strong grasp, revise the missed parts.";
        cssClass = "good";
      } else if (percent >= 50) {
        message = "üòä Decent effort! Review the gaps and practice more.";
        cssClass = "fair";
      } else {
        message = "üôå Keep trying! Revise basics and practice step by step.";
        cssClass = "poor";
      }

      document.getElementById("scoreboard").innerHTML = `
        <div><strong>Your Score:</strong> ${score} / ${total} (${percent}%)</div>
        <div id="message" class="${cssClass}">${message}</div>
      `;

      document.getElementById("restart").style.display = "inline-block";
    }

    document.getElementById("restart").addEventListener("click", () => {
      buildFilterPanel(originalData.questions);
      document.getElementById("test").innerHTML = "";
      document.getElementById("scoreboard").innerHTML = "";
      document.getElementById("restart").style.display = "none";
    });
  </script>
```
